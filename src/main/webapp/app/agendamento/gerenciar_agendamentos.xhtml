<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:p="http://primefaces.org/ui">

<h:head>
    <title>Gerenciar Agendamentos</title>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .page-container {
            max-width: 1400px;
            margin: 0 auto;
        }

        /* Header moderno */
        .page-header {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .page-header h1 {
            color: #2d3748;
            font-size: 2em;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .page-header p {
            color: #718096;
            font-size: 1em;
        }

        /* Card principal */
        .main-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            overflow: hidden;
        }

        /* Filtros modernos */
        .filters-section {
            background: #f7fafc;
            padding: 25px;
            border-bottom: 2px solid #e2e8f0;
        }

        .filters-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .filter-field {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .filter-field label {
            color: #2d3748;
            font-weight: 600;
            font-size: 0.9em;
        }

        /* Badges de status modernos */
        .status-badge {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 14px;
            border-radius: 20px;
            font-size: 0.85em;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .status-agendado {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .status-confirmado {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }

        .status-em-atendimento {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .status-concluido {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .status-cancelado {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
            color: white;
        }

        .status-nao-compareceu {
            background: linear-gradient(135deg, #a8a8a8 0%, #7f7f7f 100%);
            color: white;
        }

        /* Tabela estilizada */
        .ui-datatable {
            border: none !important;
        }

        .ui-datatable thead th {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
            padding: 15px !important;
            font-weight: 600 !important;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 0.5px;
            border: none !important;
        }

        .ui-datatable tbody td {
            padding: 15px !important;
            border-bottom: 1px solid #e2e8f0 !important;
            vertical-align: middle !important;
        }

        .ui-datatable tbody tr:hover {
            background: #f7fafc !important;
        }

        /* Diálogo moderno */
        .ui-dialog {
            border-radius: 15px !important;
            overflow: hidden !important;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3) !important;
            max-height: 90vh !important;
        }

        .ui-dialog .ui-dialog-titlebar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
            padding: 20px !important;
            border: none !important;
        }

        .ui-dialog .ui-dialog-content {
            padding: 20px !important;
            background: #f7fafc !important;
            max-height: calc(90vh - 180px) !important;
            overflow-y: auto !important;
        }

        .dialog-grid {
            display: grid;
            gap: 20px;
        }

        .dialog-field {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border-left: 4px solid #667eea;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
        }

        .dialog-field label {
            display: block;
            color: #4a5568;
            font-weight: 600;
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .dialog-field .value {
            color: #2d3748;
            font-size: 1.1em;
            font-weight: 600;
        }

        .dialog-field .icon {
            color: #667eea;
            margin-right: 10px;
            font-size: 1.2em;
        }

        /* Botões modernos */
        .ui-button {
            border-radius: 8px !important;
            padding: 10px 20px !important;
            font-weight: 600 !important;
            text-transform: uppercase;
            font-size: 0.85em;
            letter-spacing: 0.5px;
            transition: all 0.3s ease !important;
        }

        .ui-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2) !important;
        }

        .btn-filtrar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            border: none !important;
            color: white !important;
        }

        /* Estatísticas rápidas */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 4px solid;
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
        }

        .stat-card.total {
            border-left-color: #667eea;
        }

        .stat-card.hoje {
            border-left-color: #38ef7d;
        }

        .stat-card.pendentes {
            border-left-color: #f5576c;
        }

        .stat-card.concluidos {
            border-left-color: #00f2fe;
        }

        .stat-card .stat-number {
            font-size: 2em;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .stat-card .stat-label {
            color: #718096;
            font-size: 0.9em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Animações */
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-container > * {
            animation: fadeIn 0.5s ease-out;
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .page-header {
                flex-direction: column;
                gap: 20px;
                text-align: center;
            }

            .filters-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</h:head>

<h:body>
    <div class="page-container">
        <!-- Header -->
        <div class="page-header">
            <div>
                <h1><i class="pi pi-calendar" style="color: #667eea;"></i> Gerenciar Agendamentos</h1>
                <p>Sistema completo de gestão de agendamentos</p>
            </div>
            <h:form>
                <p:commandButton value="Voltar"
                                 action="/app/admin?faces-redirect=true"
                                 styleClass="ui-button-secondary"
                                 icon="pi pi-arrow-left"/>
            </h:form>
        </div>

        <h:form id="formAgendamentos">
            <p:messages id="messages" showDetail="true" closable="true"/>

            <!-- Estatísticas -->
            <div class="stats-grid">
                <div class="stat-card total">
                    <div class="stat-number">#{gerenciarAgendamentosController.totalAgendamentos}</div>
                    <div class="stat-label">Total de Agendamentos</div>
                </div>
                <div class="stat-card hoje">
                    <div class="stat-number">#{gerenciarAgendamentosController.agendamentosHoje}</div>
                    <div class="stat-label">Hoje</div>
                </div>
                <div class="stat-card pendentes">
                    <div class="stat-number">#{gerenciarAgendamentosController.agendamentosPendentes}</div>
                    <div class="stat-label">Pendentes</div>
                </div>
                <div class="stat-card concluidos">
                    <div class="stat-number">#{gerenciarAgendamentosController.agendamentosConcluidos}</div>
                    <div class="stat-label">Concluídos</div>
                </div>
            </div>

            <!-- Card Principal -->
            <div class="main-card">
                <!-- Filtros -->
                <div class="filters-section">
                    <div class="filters-grid">
                        <div class="filter-field">
                            <label><i class="pi pi-hashtag"></i> ID do Agendamento</label>
                            <p:inputText value="#{gerenciarAgendamentosController.filtroId}"
                                         placeholder="Ex: 1"
                                         style="width: 100%;"/>
                        </div>

                        <div class="filter-field">
                            <label><i class="pi pi-user"></i> Nome do Paciente</label>
                            <p:inputText value="#{gerenciarAgendamentosController.filtroUsuario}"
                                         placeholder="Digite o nome do paciente..."
                                         style="width: 100%;"/>
                        </div>

                        <div class="filter-field">
                            <label><i class="pi pi-calendar"></i> Data Início</label>
                            <p:calendar value="#{gerenciarAgendamentosController.filtroDataInicio}"
                                        pattern="dd/MM/yyyy"
                                        locale="pt"
                                        showButtonPanel="true"
                                        style="width: 100%;"/>
                        </div>

                        <div class="filter-field">
                            <label><i class="pi pi-calendar"></i> Data Fim</label>
                            <p:calendar value="#{gerenciarAgendamentosController.filtroDataFim}"
                                        pattern="dd/MM/yyyy"
                                        locale="pt"
                                        showButtonPanel="true"
                                        style="width: 100%;"/>
                        </div>

                        <div class="filter-field">
                            <label><i class="pi pi-filter"></i> Status</label>
                            <p:selectOneMenu value="#{gerenciarAgendamentosController.filtroStatus}"
                                             style="width: 100%;">
                                <f:selectItem itemLabel="Todos" itemValue=""/>
                                <f:selectItem itemLabel="Agendado" itemValue="AGENDADO"/>
                                <f:selectItem itemLabel="Confirmado" itemValue="CONFIRMADO"/>
                                <f:selectItem itemLabel="Em Atendimento" itemValue="EM_ATENDIMENTO"/>
                                <f:selectItem itemLabel="Concluído" itemValue="CONCLUIDO"/>
                                <f:selectItem itemLabel="Cancelado" itemValue="CANCELADO"/>
                            </p:selectOneMenu>
                        </div>

                        <div class="filter-field" style="display: flex; align-items: flex-end;">
                            <p:commandButton value="Aplicar Filtros"
                                             action="#{gerenciarAgendamentosController.aplicarFiltros}"
                                             update="tabelaAgendamentos messages"
                                             icon="pi pi-search"
                                             styleClass="btn-filtrar"
                                             style="width: 100%;"/>
                        </div>
                    </div>
                </div>

                <!-- Tabela -->
                <p:dataTable id="tabelaAgendamentos"
                             value="#{gerenciarAgendamentosController.agendamentos}"
                             var="agendamento"
                             paginator="true"
                             rows="15"
                             rowsPerPageTemplate="10,15,20,25"
                             emptyMessage="Nenhum agendamento encontrado"
                             paginatorPosition="bottom"
                             styleClass="ui-datatable-striped">

                    <p:column headerText="ID" style="width: 60px; text-align: center;">
                        <h:outputText value="##{agendamento.id}" style="font-weight: 600;"/>
                    </p:column>

                    <p:column headerText="Data/Hora" sortBy="#{agendamento.data}" style="width: 140px;">
                        <div style="display: flex; flex-direction: column; gap: 4px;">
                            <span style="font-weight: 600; color: #2d3748;">
                                <i class="pi pi-calendar" style="color: #667eea; font-size: 0.9em;"></i>
                                #{agendamento.dataFormatada}
                            </span>
                            <span style="color: #718096; font-size: 0.9em;">
                                <i class="pi pi-clock" style="color: #f5576c; font-size: 0.9em;"></i>
                                #{agendamento.horaFormatada}
                            </span>
                        </div>
                    </p:column>

                    <p:column headerText="Paciente">
                        <i class="pi pi-user" style="color: #667eea; margin-right: 8px;"></i>
                        <h:outputText value="#{agendamento.nomeUsuario}" style="font-weight: 500;"/>
                    </p:column>

                    <p:column headerText="Serviço">
                        <i class="pi pi-briefcase" style="color: #38ef7d; margin-right: 8px;"></i>
                        <h:outputText value="#{agendamento.nomeServico}"/>
                    </p:column>

                    <p:column headerText="Profissional">
                        <i class="pi pi-user-plus" style="color: #f5576c; margin-right: 8px;"></i>
                        <h:outputText value="#{agendamento.nomeFuncionario}"/>
                    </p:column>

                    <p:column headerText="Local do Atendimento" style="width: 180px;">
                        <i class="pi pi-map-marker" style="color: #00f2fe; margin-right: 8px;"></i>
                        <h:outputText value="#{gerenciarAgendamentosController.getNomeLocalizacao(agendamento.id)}"
                                      style="font-weight: 500; color: #2196F3;"/>
                    </p:column>

                    <p:column headerText="Status" style="width: 160px; text-align: center;">
                        <h:panelGroup rendered="#{agendamento.status.name() == 'AGENDADO'}">
                            <span class="status-badge status-agendado">
                                <i class="pi pi-calendar-plus"></i> #{agendamento.status.descricao}
                            </span>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{agendamento.status.name() == 'CONFIRMADO'}">
                            <span class="status-badge status-confirmado">
                                <i class="pi pi-check"></i> #{agendamento.status.descricao}
                            </span>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{agendamento.status.name() == 'EM_ATENDIMENTO'}">
                            <span class="status-badge status-em-atendimento">
                                <i class="pi pi-spin pi-spinner"></i> #{agendamento.status.descricao}
                            </span>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{agendamento.status.name() == 'CONCLUIDO'}">
                            <span class="status-badge status-concluido">
                                <i class="pi pi-check-circle"></i> #{agendamento.status.descricao}
                            </span>
                        </h:panelGroup>
                        <h:panelGroup rendered="#{agendamento.status.name() == 'CANCELADO'}">
                            <span class="status-badge status-cancelado">
                                <i class="pi pi-times-circle"></i> #{agendamento.status.descricao}
                            </span>
                        </h:panelGroup>
                        <h:panelGroup
                                rendered="#{agendamento.status.name() == 'NAO_COMPARECEU' or agendamento.status.name() == 'AUSENTE'}">
                            <span class="status-badge status-nao-compareceu">
                                <i class="pi pi-ban"></i> Ausente
                            </span>
                        </h:panelGroup>
                    </p:column>

                    <p:column headerText="Ações" style="width: 180px; text-align: center;">
                        <div style="display: flex; gap: 5px; justify-content: center;">
                            <p:commandButton icon="pi pi-pencil"
                                             title="Editar"
                                             action="#{gerenciarAgendamentosController.editarAgendamento(agendamento)}"
                                             update=":formAgendamentos:dialogEditar"
                                             oncomplete="PF('dialogEditar').show()"
                                             styleClass="ui-button-warning ui-button-rounded"/>

                            <p:commandButton icon="pi pi-trash"
                                             title="Cancelar"
                                             action="#{gerenciarAgendamentosController.cancelarAgendamento(agendamento.id)}"
                                             update="tabelaAgendamentos messages"
                                             styleClass="ui-button-danger ui-button-rounded"
                                             rendered="#{agendamento.status.name() != 'CANCELADO' and agendamento.status.name() != 'CONCLUIDO'}"
                                             onclick="return confirm('Deseja realmente cancelar este agendamento?');"/>
                        </div>
                    </p:column>
                </p:dataTable>
            </div>

            <!-- Dialog de Edição Moderno -->
            <p:dialog id="dialogEditar"
                      header="Editar Agendamento"
                      widgetVar="dialogEditar"
                      modal="true"
                      width="650"
                      height="600"
                      fitViewport="true"
                      maximizable="true"
                      showEffect="fade"
                      hideEffect="fade"
                      responsive="true">

                <h:panelGroup rendered="#{gerenciarAgendamentosController.agendamentoSelecionado == null}">
                    <div style="padding: 40px; text-align: center; color: #718096;">
                        <i class="pi pi-exclamation-triangle" style="font-size: 3em; color: #f5576c;"></i>
                        <p style="margin-top: 20px; font-size: 1.2em;">Nenhum agendamento selecionado</p>
                    </div>
                </h:panelGroup>

                <h:panelGroup rendered="#{gerenciarAgendamentosController.agendamentoSelecionado != null}">
                    <div class="dialog-grid">
                        <!-- Informações do Paciente -->
                        <div class="dialog-field">
                            <label><i class="pi pi-user icon"></i> Paciente</label>
                            <div class="value">
                                <h:outputText
                                        value="#{gerenciarAgendamentosController.agendamentoSelecionado.nomeUsuario}"/>
                            </div>
                        </div>

                        <!-- Serviço -->
                        <div class="dialog-field">
                            <label><i class="pi pi-briefcase icon"></i> Serviço</label>
                            <div class="value">
                                <h:outputText
                                        value="#{gerenciarAgendamentosController.agendamentoSelecionado.nomeServico}"/>
                            </div>
                        </div>

                        <!-- Data e Hora -->
                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                            <div class="dialog-field">
                                <label><i class="pi pi-calendar icon"></i> Data</label>
                                <div class="value">
                                    <h:outputText
                                            value="#{gerenciarAgendamentosController.agendamentoSelecionado.dataFormatada}"/>
                                </div>
                            </div>
                            <div class="dialog-field">
                                <label><i class="pi pi-clock icon"></i> Horário</label>
                                <div class="value">
                                    <h:outputText
                                            value="#{gerenciarAgendamentosController.agendamentoSelecionado.horaFormatada}"/>
                                </div>
                            </div>
                        </div>

                        <!-- Campos Editáveis -->
                        <div class="dialog-field">
                            <label><i class="pi pi-user-plus icon"></i> Profissional Responsável</label>
                            <p:selectOneMenu value="#{gerenciarAgendamentosController.funcionarioSelecionadoId}"
                                             style="width: 100%;">
                                <f:selectItem itemLabel="Selecione o profissional..." itemValue="#{null}"/>
                                <f:selectItems value="#{gerenciarAgendamentosController.funcionariosDisponiveis}"
                                               var="func"
                                               itemLabel="#{func.nome}"
                                               itemValue="#{func.id}"/>
                            </p:selectOneMenu>
                        </div>


                        <div class="dialog-field">
                            <label><i class="pi pi-info-circle icon"></i> Status do Atendimento</label>
                            <p:selectOneMenu value="#{gerenciarAgendamentosController.statusSelecionado}"
                                             style="width: 100%;">
                                <f:selectItem itemLabel="Agendado" itemValue="AGENDADO"/>
                                <f:selectItem itemLabel="Confirmado" itemValue="CONFIRMADO"/>
                                <f:selectItem itemLabel="Em Atendimento" itemValue="EM_ATENDIMENTO"/>
                                <f:selectItem itemLabel="Concluído" itemValue="CONCLUIDO"/>
                                <f:selectItem itemLabel="Cancelado" itemValue="CANCELADO"/>
                                <f:selectItem itemLabel="Não Compareceu" itemValue="NAO_COMPARECEU"/>
                            </p:selectOneMenu>
                        </div>

                        <div class="dialog-field">
                            <label><i class="pi pi-comment icon"></i> Observações</label>
                            <p:inputTextarea
                                    value="#{gerenciarAgendamentosController.agendamentoSelecionado.observacoes}"
                                    rows="4"
                                    placeholder="Adicione observações sobre o atendimento..."
                                    style="width: 100%;"/>
                        </div>
                    </div>
                </h:panelGroup>

                <f:facet name="footer">
                    <div style="display: flex; gap: 10px; justify-content: flex-end;">
                        <p:commandButton value="Salvar Alterações"
                                         action="#{gerenciarAgendamentosController.salvarEdicao}"
                                         update=":formAgendamentos:tabelaAgendamentos :formAgendamentos:messages"
                                         process="dialogEditar"
                                         oncomplete="PF('dialogEditar').hide();"
                                         icon="pi pi-check"
                                         ajax="true"
                                         styleClass="ui-button-success"
                                         rendered="#{gerenciarAgendamentosController.agendamentoSelecionado != null}"/>

                        <p:commandButton value="Fechar"
                                         onclick="PF('dialogEditar').hide(); return false;"
                                         type="button"
                                         icon="pi pi-times"
                                         styleClass="ui-button-secondary"/>
                    </div>
                </f:facet>
            </p:dialog>
        </h:form>
    </div>
</h:body>
</html>

