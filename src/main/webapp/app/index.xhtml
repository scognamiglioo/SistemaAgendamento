<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html
    lang="pt-BR"
    xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:f="http://xmlns.jcp.org/jsf/core"
    xmlns:p="http://primefaces.org/ui">

    <h:head>
        <title>Novo Agendamento - Sistema de Agendamento</title>
        <meta charset="UTF-8"/>
        <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            body {
                font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                min-height: 100vh;
                padding-bottom: 40px;
            }

            /* Header moderno */
            .app-header {
                background: rgba(255, 255, 255, 0.95);
                box-shadow: 0 2px 20px rgba(0,0,0,0.1);
                padding: 20px 40px;
                display: flex;
                justify-content: space-between;
                align-items: center;
                position: sticky;
                top: 0;
                z-index: 1000;
                backdrop-filter: blur(10px);
            }

            .app-header h1 {
                color: #667eea;
                font-size: 1.8em;
                font-weight: 700;
                display: flex;
                align-items: center;
                gap: 10px;
            }

            .header-actions {
                display: flex;
                align-items: center;
                gap: 15px;
            }

            .user-info {
                display: flex;
                align-items: center;
                gap: 10px;
                background: #f8f9fa;
                padding: 8px 16px;
                border-radius: 20px;
                color: #495057;
                font-weight: 500;
            }

            /* Container principal */
            .main-container {
                max-width: 900px;
                margin: 30px auto;
                padding: 0 20px;
            }

            /* Card do formulário */
            .form-card {
                background: white;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.1);
                padding: 40px;
                animation: fadeIn 0.5s ease-out;
            }

            @keyframes fadeIn {
                from {
                    opacity: 0;
                    transform: translateY(20px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .page-title {
                text-align: center;
                margin-bottom: 40px;
                padding-bottom: 20px;
                border-bottom: 2px solid #e9ecef;
            }

            .page-title h2 {
                color: #2d3748;
                font-size: 2.5em;
                font-weight: 700;
                margin-bottom: 10px;
            }

            .page-title p {
                color: #6c757d;
                font-size: 1.1em;
            }

            /* Campos do formulário */
            .form-field {
                margin-bottom: 25px;
            }

            .form-field label {
                display: block;
                color: #2d3748;
                font-weight: 600;
                font-size: 1em;
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .form-field label i {
                color: #667eea;
            }

            .form-field .required {
                color: #dc3545;
                font-weight: bold;
            }

            .form-step {
                display: inline-block;
                background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
                color: white;
                padding: 4px 12px;
                border-radius: 20px;
                font-size: 0.85em;
                font-weight: 600;
                margin-right: 8px;
            }

            /* Grid para data e hora */
            .date-time-grid {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 20px;
            }

            /* Botões */
            .ui-button {
                border-radius: 8px !important;
                font-weight: 600 !important;
                transition: all 0.3s ease !important;
            }

            .ui-button:hover {
                transform: translateY(-2px);
                box-shadow: 0 5px 15px rgba(0,0,0,0.2) !important;
            }

            .submit-button {
                margin-top: 30px;
            }

            /* Card de ajuda */
            .help-card {
                background: #f8f9fa;
                border-left: 4px solid #667eea;
                padding: 20px;
                border-radius: 10px;
                margin-top: 30px;
            }

            .help-card h3 {
                color: #2d3748;
                font-size: 1.1em;
                margin-bottom: 10px;
                display: flex;
                align-items: center;
                gap: 8px;
            }

            .help-card ul {
                color: #6c757d;
                line-height: 1.8;
                padding-left: 25px;
            }

            /* Responsivo */
            @media (max-width: 768px) {
                .app-header {
                    flex-direction: column;
                    gap: 15px;
                    padding: 15px 20px;
                }

                .form-card {
                    padding: 25px;
                }

                .date-time-grid {
                    grid-template-columns: 1fr;
                }

                .page-title h2 {
                    font-size: 1.8em;
                }
            }
        </style>
    </h:head>

    <h:body>
        <!-- Header -->
        <div class="app-header">
            <h1>
                <i class="pi pi-calendar"></i>
                Sistema de Agendamento
            </h1>
            <div class="header-actions">
                <p:button value="Meus Agendamentos"
                          icon="pi pi-list"
                          styleClass="ui-button-outlined"
                          href="meus-agendamentos.xhtml"/>

                <div class="user-info">
                    <i class="pi pi-user"></i>
                    <span>#{facesContext.externalContext.remoteUser}</span>
                </div>

                <h:form>
                    <p:commandButton value="Sair"
                                     action="#{userSessionController.logout}"
                                     icon="pi pi-sign-out"
                                     styleClass="ui-button-danger ui-button-sm"
                                     ajax="false"/>
                </h:form>
            </div>
        </div>

        <!-- Container Principal -->
        <div class="main-container">
            <div class="form-card">

                <!-- Título da Página -->
                <div class="page-title">
                    <h2>
                        <i class="pi pi-calendar-plus" style="color: #667eea;"></i>
                        Novo Agendamento
                    </h2>
                    <p>Preencha os campos abaixo para agendar seu atendimento</p>
                </div>

                <h:form id="formAgendamento">
                    <p:messages id="messages" showDetail="true" closable="true"/>

                    <!-- PASSO 1: Serviço -->
                    <div class="form-field">
                        <label>
                            <span class="form-step">1</span>
                            <i class="pi pi-briefcase"></i>
                            Selecione o Serviço
                            <span class="required">*</span>
                        </label>
                        <p:selectOneMenu id="servico"
                                         value="#{agendamentoController.servicoSelecionadoId}"
                                         required="true"
                                         requiredMessage="Selecione um serviço"
                                         style="width: 100%;">
                            <f:selectItem itemLabel="Escolha o serviço desejado..." itemValue="#{null}"/>
                            <f:selectItems value="#{agendamentoController.servicosDisponiveis}"
                                           var="s"
                                           itemLabel="#{s.nome} - R$ #{s.valor}"
                                           itemValue="#{s.id}"/>
                            <p:ajax event="change"
                                    listener="#{agendamentoController.onServicoChange}"
                                    update="panelFuncionario messages"/>
                        </p:selectOneMenu>
                    </div>

                    <!-- PASSO 2: Profissional -->
                    <p:outputPanel id="panelFuncionario" styleClass="form-field">
                        <label>
                            <span class="form-step">2</span>
                            <i class="pi pi-user"></i>
                            Selecione o Profissional
                            <span class="required">*</span>
                        </label>
                        <p:selectOneMenu id="funcionario"
                                         value="#{agendamentoController.funcionarioSelecionadoId}"
                                         required="true"
                                         requiredMessage="Selecione um profissional"
                                         style="width: 100%;">
                            <f:selectItem itemLabel="#{agendamentoController.servicoSelecionadoId == null ? 'Primeiro selecione um serviço...' : 'Escolha o profissional que irá atendê-lo...'}"
                                          itemValue="#{null}"/>
                            <f:selectItems value="#{agendamentoController.funcionariosDisponiveis}"
                                           var="f"
                                           itemLabel="#{f.nome} - #{f.cargo != null ? f.cargo.nome : 'Profissional'}"
                                           itemValue="#{f.id}"/>
                            <p:ajax event="change"
                                    listener="#{agendamentoController.onFuncionarioChange}"
                                    update="panelData panelHora messages"/>
                        </p:selectOneMenu>
                    </p:outputPanel>

                    <!-- PASSO 3 e 4: Data e Hora -->
                    <div class="date-time-grid">
                        <p:outputPanel id="panelData" styleClass="form-field">
                            <label>
                                <span class="form-step">3</span>
                                <i class="pi pi-calendar"></i>
                                Data do Atendimento
                                <span class="required">*</span>
                            </label>
                            <p:calendar id="data"
                                        value="#{agendamentoController.dataSelecionada}"
                                        required="true"
                                        requiredMessage="Selecione uma data"
                                        pattern="dd/MM/yyyy"
                                        mindate="#{agendamentoController.dataMinima}"
                                        locale="pt"
                                        showButtonPanel="true"
                                        placeholder="Selecione a data"
                                        style="width: 100%;">
                                <p:ajax event="dateSelect"
                                        listener="#{agendamentoController.onDataChange}"
                                        update="panelHora messages"/>
                            </p:calendar>
                        </p:outputPanel>

                        <p:outputPanel id="panelHora" styleClass="form-field">
                            <label>
                                <span class="form-step">4</span>
                                <i class="pi pi-clock"></i>
                                Horário do Atendimento
                                <span class="required">*</span>
                            </label>
                            <p:selectOneMenu id="hora"
                                             value="#{agendamentoController.horarioSelecionado}"
                                             required="true"
                                             requiredMessage="Selecione um horário"
                                             style="width: 100%;">
                                <f:selectItem itemLabel="#{agendamentoController.dataSelecionada == null ? 'Primeiro selecione a data...' : 'Escolha o horário disponível...'}"
                                              itemValue="#{null}"/>
                                <f:selectItems value="#{agendamentoController.horariosDisponiveis}"/>
                            </p:selectOneMenu>
                        </p:outputPanel>
                    </div>

                    <!-- Observações -->
                    <div class="form-field">
                        <label>
                            <i class="pi pi-comment"></i>
                            Observações
                            <span style="color: #6c757d; font-weight: normal; font-size: 0.9em;">(Opcional)</span>
                        </label>
                        <p:inputTextarea id="observacoes"
                                         value="#{agendamentoController.observacoes}"
                                         rows="4"
                                         placeholder="Adicione informações relevantes para o seu atendimento..."
                                         style="width: 100%;"/>
                    </div>

                    <!-- Botão de Confirmar -->
                    <div class="submit-button">
                        <p:commandButton value="Confirmar Agendamento"
                                         action="#{agendamentoController.salvarAgendamento}"
                                         update="@form"
                                         process="@form"
                                         icon="pi pi-check"
                                         styleClass="ui-button-success"
                                         style="width: 100%; padding: 15px; font-size: 1.2em;"/>
                    </div>
                </h:form>

                <!-- Card de Ajuda -->
                <div class="help-card">
                    <h3>
                        <i class="pi pi-info-circle" style="color: #667eea;"></i>
                        Como funciona?
                    </h3>
                    <ul>
                        <li>Escolha o serviço que você precisa</li>
                        <li>Selecione o profissional de sua preferência</li>
                        <li>Escolha a data e horário disponível</li>
                        <li>Adicione observações se necessário</li>
                        <li>Confirme seu agendamento e pronto!</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <div style="text-align: center; color: white; padding: 20px; margin-top: 40px;">
            <p style="font-size: 0.9em; opacity: 0.8;">
                © 2025 Sistema de Agendamento
            </p>
        </div>
    </h:body>
</html>

